{% extends 'template/jhTemplateV4.html'%}

{% block vueTemplate %}
<script type="text/html" id="app-template">
  <div>
    <v-app id="inspire" mobile-breakpoint="sm">
      <jhMenu />
      <v-main class="d-flex flex-column" style="margin-top: 60px">
        <!-- 头部内容 >>>>>>>>>>>>> -->
        <div class="d-flex" :style="{'flex-wrap': isMobile ? 'wrap' : 'nowrap'}" :class="{'px-8': !isMobile, 'px-4': isMobile}">
          <div>
            <div class="appTitle pt-3" style="font-size: 18px; font-weight: 700">{{ breadcrumbs[1].fullText }}
              <!-- 帮助页按钮 -->
              <v-icon @click="isHelpPageDrawerShow = true" small>mdi-help-circle-outline</v-icon>
            </div>
            <v-breadcrumbs class="pb-3 pt-0 pl-0" :items="breadcrumbs" divider="-"></v-breadcrumbs>
          </div>
        </div>
        <!-- <<<<<<<<<<< 头部内容 -->

        <div class="pageBodyContainer px-8" style="flex: 1;">
          <!-- 页面主要内容 -->
          <v-container class="fullScreen d-flex flex-column pa-0">
            <v-card :class="{'px-2': isMobile}" class="rounded-lg">
              <v-form v-model="isFormValid" ref="form" lazy-validation style="width: 390px; max-width: 100%" class="mx-auto">
                <v-row class="pa-0 ma-0 pa-xs-4 pb-xs-4 flex-none">
                  <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
                    <span class="inputLabel">原密码</span>
                    <v-text-field class="cus-v-input" dense filled single-line v-model="formData.oldPassword" :rules="requireRules"></v-text-field>
                  </v-col>
                  <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
                    <span class="inputLabel">新密码</span>
                    <v-text-field class="cus-v-input" dense filled single-line v-model="formData.newPassword1" :rules="requireRules"></v-text-field>
                  </v-col>
                  <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
                    <span class="inputLabel">新密码确认</span>
                    <v-text-field class="cus-v-input" dense filled single-line v-model="formData.newPassword2" :rules="requireRules"></v-text-field>
                  </v-col>
                  <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
                    <v-btn color="success" @click="resetPassword()" style="width: 100%;">确定</v-btn>
                  </v-col>
                </v-row>
              </v-form>
            </v-card>
          </v-container>
        </div>
        <!-- 帮助页抽屉 >>>>>>>>>>>>> -->
        <v-navigation-drawer v-model="isHelpPageDrawerShow" fixed temporary right width="80%" hide-overlay class="elevation-24">
          <iframe style="border: 0" :src="`/${appInfo.appId}/pageDoc?pageId=<$ ctx.packagePage.pageId $>`" width="100%" height="100%"></iframe>
        </v-navigation-drawer>
        <!-- <<<<<<<<<<< 帮助页抽屉  -->
      </v-main>
    </v-app>
    <jhToast />
    <jhMask />
    <jhConfirmDialog />
  </div>
</script>

<div id="app">
</div>
{% endblock %}

{% block vueScript %}

{% include 'common/fixedTableHeightV4.html' %}
<script type="module">
  new Vue({
    el: '#app',
    template: '#app-template',
    vuetify: new Vuetify(),
    mixins: [window.jianghuUiActionMixins],
    data: () => ({
      breadcrumbs: window.breadcrumbs,
      isHelpPageDrawerShow: false,
      // 页面变量
      isFormValid: true,
      requireRules: [v => !!v || 'This is required'],
      formData: {
        oldPassword: null,
        newPassword1: null,
        newPassword2: null,
      }
    }),
    computed: {
      isMobile() {
        return window.innerWidth < 600;
      },
    },
    watch: {},
    async created() {},
    mounted() {
    },
    methods: {
      async resetPassword () {
        if (!this.$refs.form.validate()) return false;
        if (this.formData.newPassword1 !== this.formData.newPassword2) {
            window.vtoast.fail("两次输入的密码不一致");
            return;
        }
        await window.jianghuAxios({
            data: {
                appData: {
                    pageId: 'resetUserPassword',
                    actionId: 'resetPassword',
                    actionData: {
                        oldPassword: this.formData.oldPassword,
                        newPassword: this.formData.newPassword1,
                    }
                }
            }
        })
        window.vtoast.success("密码修改成功");
        setTimeout(() => {
          location.reload();
        }, 500)
      }
    }
  })
</script>


{% endblock %}
