{% extends 'template/jhTemplateV4.html'%}

{% block vueTemplate %}
<script type="text/html" id="app-template">
<div>
<v-app mobile-breakpoint="sm">
  <jh-menu />
  <v-main class="mt-15">
    <!-- 头部内容 >>>>>>>>>>>>> -->
    <div class="jh-page-second-bar px-8">
      <div class="pt-3 text-h7 font-weight-bold">修改密码
        <!-- 帮助页按钮 -->
        <v-icon @click="isHelpPageDrawerShown = true" color="success" small>mdi-help-circle-outline</v-icon>
      </div>
      <v-breadcrumbs class="pb-3 pt-0 px-0" :items="breadcrumbs" divider="-"></v-breadcrumbs>
    </div>
    <!-- <<<<<<<<<<< 头部内容 -->

    <div class="jh-page-body-container px-8">
      <!-- 页面主要内容 -->

      <v-card class="rounded-lg">
        <v-form ref="passwordForm" lazy-validation style="width: 390px; max-width: 100%" class="mx-auto">
          <v-row class="pa-0 ma-0 pa-xs-4 pb-xs-4 flex-none">
            <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
              <span class="jh-input-label">原密码</span>
              <v-text-field class="jh-v-input" dense filled single-line v-model="formData.oldPassword" :rules="validationRules.requireRules"></v-text-field>
            </v-col>
            <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
              <span class="jh-input-label">新密码</span>
              <v-text-field class="jh-v-input" dense filled single-line v-model="formData.newPassword1" :rules="validationRules.requireRules"></v-text-field>
            </v-col>
            <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
              <span class="jh-input-label">新密码确认</span>
              <v-text-field class="jh-v-input" dense filled single-line v-model="formData.newPassword2" :rules="validationRules.newPassword2"></v-text-field>
            </v-col>
            <v-col cols="12" class="pa-xs-0 pb-xs-4 pb-3">
              <v-btn color="success" @click="resetPassword()" style="width: 100%;">确定</v-btn>
            </v-col>
          </v-row>
        </v-form>
      </v-card>
    </div>
    <!-- 帮助页抽屉 >>>>>>>>>>>>> -->
    <v-navigation-drawer v-model="isHelpPageDrawerShown" v-click-outside="drawerClickOutside" fixed temporary right width="80%" class="elevation-24">
      <iframe style="border: 0" :src="`/${appInfo.appId}/pageDoc#7.resetUserPassword.md`" width="100%" height="100%"></iframe>
      <v-btn elevation="0" color="success" fab absolute top left small tile class="drawer-close-float-btn" @click="isHelpPageDrawerShown = false">
        <v-icon>mdi-close</v-icon>
      </v-btn>
    </v-navigation-drawer>
    <!-- <<<<<<<<<<< 帮助页抽屉  -->
  </v-main>
</v-app>
<jhToast />
<jhMask />
<jhConfirmDialog />
</div>
</script>

<div id="app">
</div>
{% endblock %}

{% block vueScript %}

{% include 'common/jianghuJs/fixedTableHeightV4.html' %}
<script type="module">
new Vue({
  el: '#app',
  template: '#app-template',
  vuetify: new Vuetify(),
  data: () => ({

    breadcrumbs: [
      {text: '首页', disabled: true,},
      {text: '用户管理', disabled: true,}
    ],
    isHelpPageDrawerShown: false,
    // 页面变量

    validationRules: {
      requireRules: [
        v => !!v || 'This is required',
      ],
      newPassword2: [
        v => !!v && v === this.newPassword1
      ]
    },
    formData: {
      oldPassword: null,
      newPassword1: null,
      newPassword2: null,
    }
  }),
  computed: {
    isMobile() {
      return window.innerWidth < 600;
    },
  },
  watch: {},
  async created() {
  },
  mounted() {
  },
  methods: {
    async resetPassword() {
      if (!this.$refs.form.validate()) return false;
      if (this.formData.newPassword1 !== this.formData.newPassword2) {
        window.vtoast.fail("两次输入的密码不一致");
        return;
      }
      await window.jianghuAxios({
        data: {
          appData: {
            pageId: 'resetUserPassword',
            actionId: 'resetPassword',
            actionData: {
              oldPassword: this.formData.oldPassword,
              newPassword: this.formData.newPassword1,
            }
          }
        }
      })
      window.vtoast.success("密码修改成功");
      setTimeout(() => {
        location.reload();
      }, 500)
    }
  }
})
</script>


{% endblock %}
