{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Jianghu Config Schema",
  "description": "Schema for validating Jianghu configuration files",
  "type": "object",
  "properties": {
    "pageType": {
      "type": "string",
      "enum": ["jh-page", "jh-mobile-page", "jh-component"],
      "description": "The type of the page"
    },
    "pageId": {
      "type": "string",
      "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
      "description": "The unique identifier for the page"
    },
    "pageName": {
      "type": "string",
      "description": "The display name of the page",
      "minLength": 1
    },
    "template": {
      "type": "string",
      "description": "The template used for the page"
    },
    "table": {
      "type": "string",
      "description": "The table name of the page"
    },
    "version": {
      "type": "string",
      "enum": ["v2", "v3", "v4"],
      "description": "The version of the page"
    },
    "headContent": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/headContent"
      },
      "description": "The header content of the page, usually containing breadcrumb navigation"
    },
    "pageContent": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/pageContent"
      },
      "description": "The main content of the page"
    },
    "actionContent": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/actionContent"
      },
      "description": "Trigger content including drawers, popups, overlays, etc."
    },
    "includeList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/includeList"
      },
      "description": "List of resources included in the page"
    },
    "common": {
      "type": "object",
      "description": "Variables and methods used in the page",
      "properties": {
        "data": {
          "type": "object",
          "description": "数据对象，存储页面状态"
        },
        "dataExpression": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "description": "数据表达式的值必须是字符串类型"
          },
          "description": "数据对象的表达式"
        },
        "computed": {
          "type": "object",
          "description": "计算属性"
        },
        "watch": {
          "type": "object",
          "description": "监听器"
        },
        "doUiAction": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "description": "UI交互方法集合"
        },
        "methods": {
          "type": "object",
          "description": "方法集合"
        }
      }
    },
    "style": {
      "type": "string",
      "description": "Page style definitions"
    },
    "resourceList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/resourceList"
      }
    }
  },
  "required": ["pageType", "pageId", "pageContent", "includeList", "common"],
  "additionalProperties": false,
  "definitions": {
    "headContent": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "tag": {
              "type": "string",
              "description": "标签名称"
            }
          },
          "required": ["tag"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "tag": { "const": "jh-page-title" }
                }
              },
              "then": {
                "$ref": "#/definitions/jhPageTitle"
              }
            },
            {
              "if": {
                "properties": {
                  "tag": { "const": "jh-search" }
                }
              },
              "then": {
                "$ref": "#/definitions/jhSearch"
              }
            },
            {
              "if": {
                "properties": {
                  "tag": { "not": { "enum": ["jh-page-title", "jh-search"] } }
                }
              },
              "then": {
                "$ref": "#/definitions/customTag"
              }
            }
          ]
        },
        {
          "type": "string",
          "description": "HTML字符串内容"
        }
      ],
      "description": "页面头部内容，通常包含面包屑导航"
    },
    "pageContent": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "tag": {
              "type": "string",
              "description": "标签名称"
            }
          },
          "required": ["tag"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "tag": { "const": "jh-table" }
                }
              },
              "then": {
                "$ref": "#/definitions/jhTable"
              }
            },
            {
              "if": {
                "properties": {
                  "tag": { "not": { "const": "jh-table" } }
                }
              },
              "then": {
                "$ref": "#/definitions/customTag"
              }
            }
          ]
        },
        {
          "type": "string",
          "description": "HTML字符串内容"
        }
      ],
      "description": "页面头部内容，通常包含面包屑导航"
    },
    "actionContent": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "tag": {
              "type": "string",
              "description": "标签名称"
            }
          },
          "required": ["tag"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "tag": { "enum": ["jh-create-drawer", "jh-update-drawer", "jh-drawer", "jh-detail-drawer"] }
                }
              },
              "then": {
                "$ref": "#/definitions/jhDrawer"
              }
            },
            {
              "if": {
                "properties": {
                  "tag": { "not": { "enum": ["jh-create-drawer", "jh-update-drawer", "jh-drawer", "jh-detail-drawer"] } }
                }
              },
              "then": {
                "$ref": "#/definitions/customTag"
              }
            }
          ]
        },
        {
          "type": "string",
          "description": "HTML字符串内容"
        }
      ],
      "description": "页面头部内容，通常包含面包屑导航"
    },
    "jhPageTitle": {
      "type": "object",
      "properties": {
        "tag": {
          "type": "string",
          "description": "标签名称"
        },
        "value": {
          "type": ["string", "null"],
          "description": "标签内容值"
        },
        "attrs": {
          "type": "object",
          "description": "标签属性，如 cols, sm, md 等"
        },
        "helpBtn": {
          "type": "boolean",
          "description": "是否显示帮助按钮"
        },
        "slot": {
          "type": ["array", "object", "string"],
          "description": "插槽内容，可以是数组、对象或字符串"
        }
      },
      "additionalProperties": false
    },
    "jhDrawer": {
      "type": "object",
      "properties": {
        "tag": { "type": "string" },
        "attrs": { "type": "object" },
        "key": { "type": "string" },
        "title": { "type": "string" },
        "headSlot": { "type": "array" },
        "contentList": { 
          "type": "array",
          "items": {
            "$ref": "#/definitions/contentItem"
          }
        }
      },
      "required": ["tag", "key", "title", "contentList"],
      "additionalProperties": false
    },
    "jhTable": {
      "type": "object",
      "properties": {
        "tag": {
          "type": "string",
          "description": "标签名称"
        },
        "attrs": {
          "type": "object",
          "description": "容器属性"
        },
        "props": {
          "type": "object",
          "description": "标签内容值"
        },
        "colAttrs": {
          "type": "object",
          "description": "容器属性"
        },
        "cardAttrs": {
          "type": "object",
          "description": "容器属性"
        },
        "orderBy": {
          "type": "array",
          "description": "排序"
        },
        "headActionList": {
          "type": ["array", "object", "string"],
          "description": "头部操作"
        },
        "headers": {
          "type": ["array"],
          "description": "table headers"
        },
        "rowActionList": {
          "type": ["array", "object", "string"],
          "description": "行操作"
        },
        "value": {
          "type": ["array", "string", "object"],
          "description": "标签内容值"
        }
      },
      "required": ["tag", "headers"],
      "additionalProperties": false
    },
    "jhSearch": {
      "type": "object",
      "properties": {
        "tag": {
          "type": "string",
          "description": "标签名称"
        },
        "value": {
          "type": ["array"]
        },
        "attrs": {
          "type": "object",
          "description": "标签属性，如 cols, sm, md 等"
        },
        "searchBtn": {
          "type": "boolean",
          "description": "是否显示搜索按钮"
        }
      },
      "required": ["tag", "value"],
      "additionalProperties": false
    },
    "customTag": {
      "type": "object",
      "properties": {
        "tag": { "type": "string" },
        "attrs": { "type": "object" },
        "value": { "type": ["array", "string", "object"] }
      },
      "required": ["tag"],
      "additionalProperties": false
    },
    "contentItem": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "tag": {
              "type": "string",
              "description": "标签名称"
            }
          },
          "allOf": [
            {
              "if": {
                "properties": {
                  "type": { "const": "form" }
                }
              },
              "then": {
                "$ref": "#/definitions/contentForm"
              }
            },
            {
              "if": {
                "properties": {
                  "type": { "not": { "const": "form" } }
                }
              },
              "then": {
                "$ref": "#/definitions/customTag"
              }
            }
          ]
        },
        {
          "type": "string",
          "description": "HTML字符串内容"
        }
      ],
      "description": "内容项"
    },
    "contentForm": {
      "type": "object",
      "properties": {
        "type": { "type": "string" },
        "label": { "type": "string" },
        "formItemList": { 
          "type": "array",
          "items": {
            "$ref": "#/definitions/formItem"
          }
        },
        "action": { "type": ["object", "array", "string"] }
      },
      "required": ["type", "label", "formItemList"],
      "additionalProperties": false
    },
    "formItem": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "tag": {
              "type": "string",
              "description": "标签名称"
            }
          },
          "required": ["tag"],
          "allOf": [
            {
              "if": {
                "properties": {
                  "model": { 
                    "type": "string",
                    "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
                  }
                },
                "required": ["model"]
              },
              "then": {
                "properties": {
                  "label": { "type": "string" },
                  "rules": { "type": "string" },
                  "attrs": { "type": "object" },
                  "colAttrs": { "type": "object" },
                  "tag": { "type": "string" },
                  "md": { "type": ["string", "number"] }
                }
              }
            },
            {
              "if": {
                "not": {
                  "required": ["model"]
                }
              },
              "then": {
                "$ref": "#/definitions/customTag"
              }
            }
          ]
        },
        {
          "type": "string",
          "description": "HTML字符串内容"
        }
      ],
      "description": "内容项"
    },
    "includeList": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "minLength": 1
        },
        "path": {
          "type": "string",
          "minLength": 1
        }
      },
      "required": ["type", "path"],
      "additionalProperties": false
    },
    "resourceList": {
      "type": "object",
      "properties": {
        "actionId": {
          "type": "string",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
        },
        "desc": { "type": "string" },
        "resourceType": {
          "type": "string",
          "enum": ["sql", "service"]
        },
        "resourceData": {
          "type": "object",
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "table": { "type": "string", "minLength": 1 },
                "operation": {
                  "enum": ["select", "jhInsert", "jhUpdate", "jhDelete", "insert", "update", "delete"]
                }
              },
              "required": ["table", "operation"],
              "additionalProperties": false,
              "if": { "properties": { "resourceType": { "const": "sql" } } },
              "then": { "properties": { "resourceType": { "const": "sql" } } }
            },
            {
              "type": "object",
              "properties": {
                "service": { "type": "string", "minLength": 1 },
                "serviceFunction": { "type": "string", "minLength": 1 }
              },
              "required": ["service", "serviceFunction"],
              "additionalProperties": false,
              "if": { "properties": { "resourceType": { "const": "service" } } },
              "then": { "properties": { "resourceType": { "const": "service" } } }
            }
          ]
        },
        "resourceHook": {
          "type": "object",
          "properties": {
            "before": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "service": { "type": "string", "minLength": 1 },
                  "serviceFunction": { "type": "string", "minLength": 1 }
                },
                "required": ["service", "serviceFunction"],
                "additionalProperties": false
              }
            },
            "after": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "service": { "type": "string", "minLength": 1 },
                  "serviceFunction": { "type": "string", "minLength": 1 }
                },
                "required": ["service", "serviceFunction"],
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["actionId", "resourceType", "resourceData"],
      "additionalProperties": false,
      "if": {
        "properties": {
          "resourceType": { "const": "sql" }
        }
      },
      "then": {
        "properties": {
          "resourceData": {
            "properties": {
              "table": { "type": "string" },
              "operation": { "type": "string" }
            },
            "required": ["table", "operation"]
          }
        }
      },
      "else": {
        "properties": {
          "resourceData": {
            "properties": {
              "service": { "type": "string" },
              "serviceFunction": { "type": "string" }
            },
            "required": ["service", "serviceFunction"]
          }
        }
      }
    }
  }
} 