{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Jianghu Config Schema",
    "description": "Schema for validating Jianghu configuration files",
    "type": "object",
    "properties": {
        "pageType": {
            "type": "string",
            "enum": ["jh-page", "jh-mobile-page", "jh-component"],
            "description": "The type of the page"
        },
        "pageId": {
            "type": "string",
            "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$",
            "description": "The unique identifier for the page"
        },
        "pageName": {
            "type": "string",
            "description": "The display name of the page",
            "minLength": 1
        },
        "template": {
            "type": "string",
            "description": "The template used for the page"
        },
        "table": {
            "type": "string",
            "description": "The table name of the page"
        },
        "version": {
            "type": "string",
            "enum": ["v2", "v3", "v4"],
            "description": "The version of the page"
        },
        "headContent": {
            "type": "array",
            "description": "The header content of the page, usually containing breadcrumb navigation"
        },
        "pageContent": {
            "type": "array",
            "description": "The main content of the page"
        },
        "actionContent": {
            "type": "array",
            "description": "Trigger content including drawers, popups, overlays, etc."
        },
        "includeList": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/include"
            },
            "description": "List of resources included in the page"
        },
        "common": {
            "type": "object",
            "description": "Variables and methods used in the page",
            "properties": {
                "data": {
                    "type": "object",
                    "description": "数据对象，存储页面状态"
                },
                "dataExpression": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "string",
                        "description": "数据表达式的值必须是字符串类型"
                    },
                    "description": "数据对象的表达式"
                },
                "computed": {
                    "type": "object",
                    "description": "计算属性"
                },
                "watch": {
                    "type": "object",
                    "description": "监听器"
                },
                "methods": {
                    "type": "object",
                    "description": "方法集合"
                },
                "doUiAction": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "description": "UI交互方法集合"
                }
            }
        },
        "style": {
            "type": "string",
            "description": "Page style definitions"
        },
        "resourceList": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/resource"
            }
        }
    },
    "required": ["pageType", "pageId", "headContent", "pageContent", "actionContent", "includeList", "common"],
    "additionalProperties": false,
    "definitions": {
        "include": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "minLength": 1
                },
                "path": {
                    "type": "string",
                    "minLength": 1
                }
            },
            "required": ["type", "path"],
            "additionalProperties": false
        },
        "resource": {
            "type": "object",
            "properties": {
                "actionId": {
                    "type": "string",
                    "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
                },
                "desc": { "type": "string" },
                "resourceType": {
                    "type": "string",
                    "enum": ["sql", "service"]
                },
                "resourceData": {
                    "type": "object",
                    "oneOf": [
                        {
                            "type": "object",
                            "properties": {
                                "table": { "type": "string", "minLength": 1 },
                                "operation": {
                                    "enum": ["select", "jhInsert", "jhUpdate", "jhDelete", "insert", "update", "delete"]
                                }
                            },
                            "required": ["table", "operation"],
                            "additionalProperties": false,
                            "if": { "properties": { "resourceType": { "const": "sql" } } },
                            "then": { "properties": { "resourceType": { "const": "sql" } } }
                        },
                        {
                            "type": "object",
                            "properties": {
                                "service": { "type": "string", "minLength": 1 },
                                "serviceFunction": { "type": "string", "minLength": 1 }
                            },
                            "required": ["service", "serviceFunction"],
                            "additionalProperties": false,
                            "if": { "properties": { "resourceType": { "const": "service" } } },
                            "then": { "properties": { "resourceType": { "const": "service" } } }
                        }
                    ]
                },
                "resourceHook": {
                    "type": "object",
                    "properties": {
                        "before": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "service": { "type": "string", "minLength": 1 },
                                    "serviceFunction": { "type": "string", "minLength": 1 }
                                },
                                "required": ["service", "serviceFunction"],
                                "additionalProperties": false
                            }
                        },
                        "after": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "service": { "type": "string", "minLength": 1 },
                                    "serviceFunction": { "type": "string", "minLength": 1 }
                                },
                                "required": ["service", "serviceFunction"],
                                "additionalProperties": false
                            }
                        }
                    },
                    "additionalProperties": false
                }
            },
            "required": ["actionId", "resourceType", "resourceData"],
            "additionalProperties": false,
            "if": {
                "properties": {
                    "resourceType": { "const": "sql" }
                }
            },
            "then": {
                "properties": {
                    "resourceData": {
                        "properties": {
                            "table": { "type": "string" },
                            "operation": { "type": "string" }
                        },
                        "required": ["table", "operation"]
                    }
                }
            },
            "else": {
                "properties": {
                    "resourceData": {
                        "properties": {
                            "service": { "type": "string" },
                            "serviceFunction": { "type": "string" }
                        },
                        "required": ["service", "serviceFunction"]
                    }
                }
            }
        }
    }
}
